#!/bin/bash
set -euo pipefail

echo "ğŸ” Setting up Atuin (encrypted shell history)..."

# Check if atuin is installed
if ! command -v atuin >/dev/null 2>&1; then
  echo "âš ï¸  Atuin not found. Install with: brew install atuin"
  exit 1
fi

# Check if atuin is already configured (has a database)
if [[ -f ~/.local/share/atuin/history.db ]] || [[ -f ~/.config/atuin/key ]]; then
  echo "âœ… Atuin already configured. Skipping setup."
  exit 0
fi

echo "ğŸ“ Initializing Atuin..."

# Initialize atuin (creates local database and encryption key)
atuin init

echo "ğŸ”‘ Atuin has been initialized with local encryption."
echo "ğŸ’¡ To sync across machines:"
echo "   1. Create account: atuin register -u <email> -p <password>"
echo "   2. Login on other machines: atuin login -u <email> -p <password>"
echo "   3. Import existing history: atuin import auto"
echo ""
echo "âœ… Atuin setup complete! Restart your shell to activate."